# Лабораторная работа №13: Управление кластером Docker Swarm
## Шаг 1: Создание кластера Docker Swarm
Сначала создадим кластер с одной мастер-ноды и тремя рабочими нодами:
```docker
 swarm init --advertise-addr <IP_МАСТЕР_НОДЫ>
```
Добавим три рабочие ноды к кластеру:
```docker
 swarm join --token <TOKEN> <IP_МАСТЕР_НОДЫ>:2377
```
Проверим состояние кластера:
```
docker node ls
```
## Шаг 2: Добавление сервиса containous/whoami
Создадим файл docker-compose.yml со следующей конфигурацией:
```yaml
version: '3'
services:
  whoami:
    image: containous/whoami
    deploy:
      replicas: 6
```
Развернем стек:
```docker
 stack deploy -c docker-compose.yml whoami_stack
```
Проверим статус сервиса:

```docker service ls```
## Шаг 3: Изменение статуса рабочих нод
Первыми двумя рабочим нодам присвоем статус мастера:
```docker node 
update --availability active <ID_РABОЧЕЙ_НОДЫ>
```
Теперь у нас есть два мастера и одна рабочая нода.

## Шаг 4: Приведение первой рабочей ноды в роль мастера
Приведем первую рабочую ноду в роль мастера:
```docker node 
update --role manager <ID_Рабочей_Ноды>
```
Теперь у нас должно быть три мастера.
## Шаг 5: Выключение одной ноды
Выключаем одну из нод принудительно:
```docker node rm 
<ID_УДАЛЯЕМОЙ_НОДЫ>
```
Проверяем распределение контейнеров:
```docker service ps```
## Шаг 6: Добавление новой рабочей ноды
Добавляем новую рабочую ноду в кластер:
```docker 
swarm join --token <TOKEN> <IP_МАСТЕР_НОДЫ>:2377
```
Проверяем распределение контейнеров после добавления новой ноды:
```docker service ps```
## Шаг 7: Создание нового сервиса с политикой обновления
Создадим новый файл docker-compose.yml для сервиса nginx:
```yaml
version: '3'
services:
  nginx:
    image: nginx:alpine
    deploy:
      replicas: 3
      update_config:
        parallelism: 2
        delay: 10s
        order: stop-first
```
Развернем стек:
```docker 
stack deploy -c docker-compose.yml nginx_stack
```






