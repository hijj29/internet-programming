# Лабораторная работа №11: Управление кластером Docker Swarm
## 1. Создание кластера с одной управляющей и двумя рабочими нодами
Настройка управляющей ноды:
Инициализировал кластер Swarm на управляющей ноде:
```bash
docker swarm init --advertise-addr <MANAGER_IP>
```
Получил токен для подключения рабочих нод:
```bash
docker swarm join-token worker
```
Присоединение рабочих нод:
Выполнил команду на рабочих нодах для их подключения к кластеру:
```bash
docker swarm join --token <TOKEN> <MANAGER_IP>:2377
```
Проверка состояния кластера:
Убедился, что все ноды присоединились:
```bash
docker node ls
```
## 2. Удаление рабочей ноды и ее повторное добавление
Отключил рабочую ноду от кластера:

```bash
docker node rm <NODE_ID>
```
Повторно присоединил рабочую ноду:

```bash
docker swarm join --token <TOKEN> <MANAGER_IP>:2377
```
Проверил статус после добавления:

```bash
docker node ls
```
## 3. Создание Docker-образа для вывода метаданных узла
Dockerfile:
```dockerfile
FROM python:3.9-slim
WORKDIR /usr/src/app
COPY app.py .
RUN pip install flask
EXPOSE 8080
CMD ["python", "app.py"]
```
Код приложения app.py:
python
```from flask import Flask, jsonify
import socket

app = Flask(name)

@app.route('/')
def get_metadata():
    return jsonify({
        "Hostname": socket.gethostname(),
        "IP Address": socket.gethostbyname(socket.gethostname())
    })

if name == "main":
    app.run(host="0.0.0.0", port=8080)
```
Сборка образа:
Собрал Docker-образ:
bash
Копировать код
docker build -t metadata-app:v1 .
4. Развертывание сервиса с 3 репликами
Создал сервис с 3 репликами:

bash
Копировать код
docker service create --name metadata-service --replicas 3 -p 8080:8080 metadata-app:v1
Проверил состояние реплик:

bash
Копировать код
docker service ps metadata-service
Выполнил тестирование доступа к репликам, проверяя IP-адреса, на которые направляются запросы:

bash
Копировать код
curl <MANAGER_IP>:8080
5. Пересборка образа и обновление сервиса
Изменение Dockerfile:
Добавил информацию о разработчике:
dockerfile
Копировать код
FROM python:3.9-slim
LABEL maintainer="Your Name <your.email@example.com>"
WORKDIR /usr/src/app
COPY app.py .
RUN pip install flask
EXPOSE 8080
CMD ["python", "app.py"]
Пересборка образа:
bash
Копировать код
docker build -t metadata-app:v2 .
Обновление сервиса:
Обновил существующий сервис до новой версии образа:

bash
Копировать код
docker service update --image metadata-app:v2 metadata-service
Убедился, что сервис успешно обновлен:

bash
Копировать код
docker service ps metadata-service
curl <MANAGER_IP>:8080
